# CI環境専用の設定
# 使い方: docker compose -f docker-compose.yml -f docker-compose.ci.yml up
#
# 変更点（従来のdocker-compose.ci.ymlから）:
# - バインドマウントを完全に削除（コードはイメージに埋め込み済み）
# - イメージ名を明示的に指定（ビルドなし）
# - Apache設定もイメージに埋め込み（entrypoint.shでCI=true時に適用）

services:
  app:
    image: oc-review-mock-app:latest
    # CI環境ではプリビルドイメージを使用（.github/workflows/ci.ymlでpull/build）
    # IMPORTANT: volumesを完全に再定義してdocker-compose.ymlのマウントを無効化
    volumes: !reset []
    working_dir: /var/www/html
    depends_on:
      - line-mock-api
    networks:
      - default
      - mock-network
    environment:
      - CI=true
      - IS_MOCK_ENVIRONMENT=1
      - CRON=0
      - ENABLE_XDEBUG=0

  mysql:
    networks:
      - default
      - mock-network

  # LINE公式サイトエミュレーションサーバー
  line-mock-api:
    image: oc-review-mock-line-mock-api:latest
    # CI環境ではプリビルドイメージを使用（.github/workflows/ci.ymlでpull/build）
    ports:
      - "9000:80"
    environment:
      - TZ=Asia/Tokyo
      - LANG=ja_JP.UTF-8
      - MOCK_API_TYPE=fixed
    networks:
      mock-network:
        ipv4_address: 10.99.0.10

networks:
  mock-network:
    driver: bridge
    ipam:
      config:
        - subnet: 10.99.0.0/16
